#
# Generated by Chef
#
# spydle - Spydle Server Monitor
#
description     "Spydle Server Monitor"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

pre-start script
    test -x <%= node[:spydle][:conf_dir] %> || { stop; exit 0; }
end script

respawn
respawn limit 10 5

<%
  classpath = []
  classpath << "#{node[:spydle][:lib_dir]}/#{File.basename(node[:spydle][:package_url])}"
%>

exec su <%= node[:spydle][:user] %> -c '<%= node["java"]["java_home"] %>/bin/java -cp "<%= classpath.join(":") %>" org.realityforge.spydle.Main --config-directory "<%= node[:spydle][:conf_dir] %>"'
